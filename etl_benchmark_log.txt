:: loading settings :: url = jar:file:/opt/spark/jars/ivy-2.5.1.jar!/org/apache/ivy/core/settings/ivysettings.xml
Ivy Default Cache set to: /root/.ivy2/cache
The jars for the packages stored in: /root/.ivy2/jars
io.delta#delta-spark_2.12 added as a dependency
org.apache.hadoop#hadoop-aws added as a dependency
com.amazonaws#aws-java-sdk-bundle added as a dependency
:: resolving dependencies :: org.apache.spark#spark-submit-parent-b39cd024-5812-4a01-896b-816d734e9d1e;1.0
	confs: [default]
	found io.delta#delta-spark_2.12;3.0.0 in central
	found io.delta#delta-storage;3.0.0 in central
	found org.antlr#antlr4-runtime;4.9.3 in central
	found org.apache.hadoop#hadoop-aws;3.3.4 in central
	found com.amazonaws#aws-java-sdk-bundle;1.12.262 in central
	found org.wildfly.openssl#wildfly-openssl;1.0.7.Final in central
:: resolution report :: resolve 381ms :: artifacts dl 19ms
	:: modules in use:
	com.amazonaws#aws-java-sdk-bundle;1.12.262 from central in [default]
	io.delta#delta-spark_2.12;3.0.0 from central in [default]
	io.delta#delta-storage;3.0.0 from central in [default]
	org.antlr#antlr4-runtime;4.9.3 from central in [default]
	org.apache.hadoop#hadoop-aws;3.3.4 from central in [default]
	org.wildfly.openssl#wildfly-openssl;1.0.7.Final from central in [default]
	---------------------------------------------------------------------
	|                  |            modules            ||   artifacts   |
	|       conf       | number| search|dwnlded|evicted|| number|dwnlded|
	---------------------------------------------------------------------
	|      default     |   6   |   0   |   0   |   0   ||   6   |   0   |
	---------------------------------------------------------------------
:: retrieving :: org.apache.spark#spark-submit-parent-b39cd024-5812-4a01-896b-816d734e9d1e
	confs: [default]
	0 artifacts copied, 6 already retrieved (0kB/12ms)
26/01/11 16:08:04 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
2026-01-11 16:08:10 | INFO     | __main__:run_full_pipeline:31 - ðŸš€ Starting MediFlow Full ETL Pipeline
2026-01-11 16:08:10 | INFO     | src.ingestion.bronze_ingestion:ingest_raw_data:15 - Starting ingestion from /app/data/raw/patients_synthetic.csv for system EHR_SYSTEM_A
[Stage 0:>                                                          (0 + 0) / 1][Stage 0:>                                                          (0 + 1) / 1]                                                                                [Stage 1:>                                                          (0 + 2) / 2][Stage 1:=============================>                             (1 + 1) / 2]                                                                                2026-01-11 16:08:41 | INFO     | src.ingestion.bronze_ingestion:ingest_raw_data:35 - Writing data to Bronze layer at s3a://bronze/healthcare
26/01/11 16:08:42 WARN MetricsConfig: Cannot locate configuration: tried hadoop-metrics2-s3a-file-system.properties,hadoop-metrics2.properties
[Stage 2:>                                                          (0 + 2) / 2]                                                                                2026-01-11 16:09:00 | INFO     | src.ingestion.bronze_ingestion:ingest_raw_data:40 - Ingestion to Bronze layer completed successfully
2026-01-11 16:09:00 | INFO     | src.transformation.silver_transform:clean_and_normalize:16 - Starting Silver transformation from s3a://bronze/healthcare
2026-01-11 16:09:01 | INFO     | src.transformation.silver_transform:clean_and_normalize:37 - Writing to Silver layer at s3a://silver/healthcare
[Stage 5:=======================================>                   (2 + 1) / 3]                                                                                2026-01-11 16:09:04 | INFO     | src.transformation.silver_transform:clean_and_normalize:41 - Performing MERGE operation into Silver Delta table
[Stage 6:>                                                          (0 + 2) / 2][Stage 6:=============================>                             (1 + 1) / 2][Stage 8:>                                                          (0 + 2) / 2][Stage 8:=============================>                             (1 + 1) / 2]                                                                                26/01/11 16:09:21 ERROR NonFateSharingFuture: Failed to get result from future
scala.runtime.NonLocalReturnControl
26/01/11 16:09:21 WARN SparkStringUtils: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting 'spark.sql.debug.maxToStringFields'.
[Stage 9:>                                                          (0 + 2) / 3][Stage 9:===================>                                       (1 + 2) / 3][Stage 9:=======================================>                   (2 + 1) / 3][Stage 11:>                                                        (0 + 2) / 50][Stage 11:==>                                                      (2 + 2) / 50][Stage 11:====>                                                    (4 + 2) / 50][Stage 11:======>                                                  (6 + 2) / 50][Stage 11:=========>                                               (8 + 2) / 50][Stage 11:===========>                                            (10 + 2) / 50][Stage 11:============>                                           (11 + 2) / 50][Stage 11:=============>                                          (12 + 2) / 50][Stage 11:===============>                                        (14 + 2) / 50][Stage 11:=================>                                      (16 + 2) / 50][Stage 11:====================>                                   (18 + 2) / 50][Stage 11:=====================>                                  (19 + 2) / 50][Stage 11:======================>                                 (20 + 2) / 50][Stage 11:========================>                               (22 + 2) / 50][Stage 11:=========================>                              (23 + 2) / 50][Stage 11:============================>                           (25 + 2) / 50][Stage 11:=============================>                          (26 + 2) / 50][Stage 11:===============================>                        (28 + 2) / 50][Stage 11:================================>                       (29 + 2) / 50][Stage 11:=================================>                      (30 + 2) / 50][Stage 11:==================================>                     (31 + 2) / 50][Stage 11:===================================>                    (32 + 2) / 50][Stage 11:======================================>                 (34 + 2) / 50][Stage 11:========================================>               (36 + 2) / 50][Stage 11:==========================================>             (38 + 2) / 50][Stage 11:============================================>           (40 + 2) / 50][Stage 11:===============================================>        (42 + 2) / 50][Stage 11:=================================================>      (44 + 2) / 50][Stage 11:=====================================================>  (48 + 2) / 50]                                                                                [Stage 16:===>                                                     (3 + 2) / 50][Stage 16:==========>                                              (9 + 2) / 50][Stage 16:================>                                       (15 + 2) / 50][Stage 16:=======================>                                (21 + 2) / 50][Stage 16:============================>                           (25 + 2) / 50][Stage 16:==================================>                     (31 + 2) / 50][Stage 16:========================================>               (36 + 2) / 50][Stage 16:============================================>           (40 + 3) / 50][Stage 16:===================================================>    (46 + 2) / 50]                                                                                [Stage 17:>                                                         (0 + 2) / 2]                                                                                [Stage 18:>                                                         (0 + 2) / 2][Stage 18:=============================>                            (1 + 1) / 2][Stage 20:=============================>                            (1 + 1) / 2]                                                                                [Stage 24:>                                                         (0 + 2) / 2][Stage 24:>                 (0 + 2) / 2][Stage 25:>                 (0 + 0) / 2][Stage 24:=========>        (1 + 1) / 2][Stage 25:>                 (0 + 1) / 2][Stage 25:>                                                         (0 + 2) / 2][Stage 25:=============================>                            (1 + 1) / 2][Stage 28:>                                                         (0 + 2) / 2][Stage 28:=============================>                            (1 + 1) / 2][Stage 32:>                                                         (0 + 1) / 1]                                                                                [Stage 36:======>                                                  (6 + 2) / 50][Stage 36:==========>                                              (9 + 2) / 50][Stage 36:=============>                                          (12 + 2) / 50][Stage 36:=================>                                      (16 + 2) / 50][Stage 36:======================>                                 (20 + 2) / 50][Stage 36:==========================>                             (24 + 2) / 50][Stage 36:===============================>                        (28 + 2) / 50][Stage 36:===================================>                    (32 + 2) / 50][Stage 36:========================================>               (36 + 2) / 50][Stage 36:============================================>           (40 + 2) / 50][Stage 36:================================================>       (43 + 2) / 50][Stage 36:===================================================>    (46 + 2) / 50]                                                                                2026-01-11 16:10:09 | INFO     | src.transformation.silver_transform:clean_and_normalize:58 - Optimizing Silver Delta table with Z-Order on patient_id
[Stage 41:==========================>                             (24 + 2) / 50][Stage 41:===================================>                    (32 + 2) / 50][Stage 41:================================================>       (43 + 2) / 50]                                                                                [Stage 42:=============================>                            (1 + 1) / 2]                                                                                [Stage 43:=============================>                            (1 + 1) / 2][Stage 45:>                                                         (0 + 1) / 1]                                                                                [Stage 49:=========>                                               (8 + 2) / 50][Stage 49:===========>                                            (10 + 2) / 50][Stage 49:=================>                                      (16 + 2) / 50][Stage 49:======================>                                 (20 + 2) / 50][Stage 49:==========================>                             (24 + 2) / 50][Stage 49:===============================>                        (28 + 2) / 50][Stage 49:===================================>                    (32 + 2) / 50][Stage 49:========================================>               (36 + 2) / 50][Stage 49:============================================>           (40 + 2) / 50][Stage 49:=================================================>      (44 + 2) / 50][Stage 49:======================================================> (49 + 1) / 50]                                                                                2026-01-11 16:10:24 | INFO     | src.transformation.silver_transform:clean_and_normalize:61 - Silver transformation completed successfully
2026-01-11 16:10:24 | INFO     | __main__:run_full_pipeline:46 - ðŸ” Running anomaly detection on Silver layer
2026-01-11 16:10:24 | INFO     | src.quality.anomaly_detector:detect_statistical_anomalies:16 - Running Z-Score anomaly detection on column: cost
[Stage 54:============================>                           (25 + 2) / 50][Stage 54:========================================>               (36 + 2) / 50]                                                                                [Stage 59:======================>                                 (20 + 2) / 50][Stage 59:==================================>                     (31 + 2) / 50][Stage 59:=================================================>      (44 + 2) / 50]                                                                                2026-01-11 16:10:27 | INFO     | src.quality.anomaly_detector:detect_statistical_anomalies:48 - Detected 9930 anomalies in cost
2026-01-11 16:10:28 | WARNING  | __main__:run_full_pipeline:53 - ðŸš¨ Detected 9930 cost anomalies in Silver layer
2026-01-11 16:10:28 | INFO     | src.transformation.gold_aggregation:create_patient_summary:15 - Starting Gold aggregation from s3a://silver/healthcare
2026-01-11 16:10:29 | INFO     | src.transformation.gold_aggregation:create_patient_summary:37 - Writing to Gold layer at s3a://gold/healthcare
[Stage 71:=============================>                            (1 + 1) / 2]                                                                                [Stage 76:==========>                                              (9 + 2) / 50][Stage 76:==============>                                         (13 + 2) / 50][Stage 76:=====================>                                  (19 + 2) / 50][Stage 76:=========================>                              (23 + 2) / 50][Stage 76:================================>                       (29 + 2) / 50][Stage 76:====================================>                   (33 + 2) / 50][Stage 76:===========================================>            (39 + 2) / 50][Stage 76:==================================================>     (45 + 2) / 50]                                                                                [Stage 85:=====================>                                  (19 + 2) / 50][Stage 85:=============================>                          (26 + 2) / 50][Stage 85:====================================>                   (33 + 2) / 50][Stage 85:===========================================>            (39 + 2) / 50][Stage 85:==================================================>     (45 + 2) / 50]                                                                                2026-01-11 16:10:39 | INFO     | src.transformation.gold_aggregation:create_patient_summary:44 - Gold aggregation completed successfully
2026-01-11 16:10:39 | INFO     | __main__:run_full_pipeline:64 - ðŸ“Š Running final data quality checks and reporting
2026-01-11 16:10:39 | INFO     | src.quality.data_validator:validate_silver_layer:18 - Starting Silver layer validation
[Stage 90:===============================================>        (42 + 2) / 50]                                                                                [Stage 91:=============================>                            (1 + 1) / 2]                                                                                [Stage 95:=============================>                            (1 + 1) / 2]                                                                                2026-01-11 16:10:51 | WARNING  | src.quality.data_validator:validate_silver_layer:46 - Silver layer validation FAILED for columns: ['age']
2026-01-11 16:10:51 | INFO     | src.quality.data_validator:validate_gold_layer:54 - Starting Gold layer validation
2026-01-11 16:10:53 | WARNING  | src.quality.data_validator:validate_gold_layer:67 - Gold layer validation FAILED
[Stage 153:>                                                        (0 + 2) / 2]                                                                                26/01/11 16:10:54 WARN AbstractS3ACommitterFactory: Using standard FileOutputCommitter to commit work. This is slow and potentially unsafe.
2026-01-11 16:10:55 | INFO     | src.quality.quality_reporter:save_report:32 - Quality report for silver saved to s3a://metadata/quality_reports/silver_20260111_161053.json
26/01/11 16:10:55 WARN AbstractS3ACommitterFactory: Using standard FileOutputCommitter to commit work. This is slow and potentially unsafe.
2026-01-11 16:10:56 | INFO     | src.quality.quality_reporter:save_report:32 - Quality report for gold saved to s3a://metadata/quality_reports/gold_20260111_161055.json
2026-01-11 16:10:56 | INFO     | __main__:run_full_pipeline:75 - ðŸ¤– Starting ML Training
2026-01-11 16:10:56 | INFO     | src.ml.model_trainer:train_cost_predictor:16 - Starting ML Model Training for Cost Prediction
[Stage 157:============================>                            (1 + 1) / 2]                                                                                [Stage 160:============================>                            (1 + 1) / 2]                                                                                [Stage 163:============================>                            (1 + 1) / 2]                                                                                [Stage 166:>                                                        (0 + 1) / 1]                                                                                [Stage 167:============================>                            (1 + 1) / 2]                                                                                [Stage 168:============================>                            (1 + 1) / 2]                                                                                [Stage 170:============================>                            (1 + 1) / 2]                                                                                [Stage 172:============================>                            (1 + 1) / 2]                                                                                [Stage 174:============================>                            (1 + 1) / 2]                                                                                [Stage 176:============================>                            (1 + 1) / 2]                                                                                [Stage 178:============================>                            (1 + 1) / 2]                                                                                2026-01-11 16:11:28 | INFO     | src.ml.model_trainer:train_cost_predictor:42 - Model training completed successfully
2026-01-11 16:11:33 | INFO     | src.ml.model_trainer:train_cost_predictor:47 - Model saved to s3a://metadata/models/cost_predictor
2026-01-11 16:11:33 | INFO     | __main__:run_full_pipeline:79 - ðŸ”® Running sample prediction test
2026-01-11 16:11:36 | INFO     | src.ml.prediction_service:load_model:19 - Model loaded successfully from s3a://metadata/models/cost_predictor
2026-01-11 16:11:37 | INFO     | __main__:run_full_pipeline:82 - Test prediction for age 45, F, Cardiology, I10: $7756.01
2026-01-11 16:11:37 | INFO     | __main__:run_full_pipeline:86 - âœ… Full ETL Pipeline completed successfully in 206.37 seconds
